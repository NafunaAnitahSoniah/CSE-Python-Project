{% extends 'base_agent.html' %}
{% block title %}Register Farmer | Young4ChickS{% endblock %}
{% block content %}
<header class="page-header">
    <h1>Register New Farmer</h1>
    <div class="subtitle">Add a new farmer to the system</div>
</header>
<section class="card fade-in">
    <h4><i class="fas fa-user-plus"></i> Farmer Registration Form</h4>
    <form method="post" class="form-grid">
        {% csrf_token %}
        <div class="form-group">
            <label for="farmer_name">Farmer Name:</label>
            <input class="form-control" type="text" name="farmer_name" id="farmer_name" maxlength="50" required>
        </div>
        <div class="form-group">
            <label for="date_of_birth">Date of Birth:</label>
            <input class="form-control" type="date" name="date_of_birth" id="date_of_birth" required>
        </div>
        <div class="form-group">
            <label for="gender">Gender:</label>
            <select class="form-control" name="gender" id="gender" required>
                <option value="">Select Gender</option>
                <option value="M">Male</option>
                <option value="F">Female</option>
            </select>
        </div>
        <div class="form-group">
            <label for="location">Location:</label>
            <input class="form-control" type="text" name="location" id="location" maxlength="30" required>
        </div>
        <div class="form-group">
            <label for="nin">NIN:</label>
            <input class="form-control" type="text" name="nin" id="nin" maxlength="14" pattern="[A-Z0-9]{14}" required
                placeholder="14 alphanumeric characters">
        </div>
        <div class="form-group">
            <label for="phone_number">Phone Number:</label>
            <input class="form-control" type="text" name="phone_number" id="phone_number" maxlength="10"
                pattern="[0-9]{10}" title="Phone number must be exactly 10 digits" required>
        </div>
        <div class="form-group">
            <label for="recommender_name">Recommender Name:</label>
            <input class="form-control" type="text" name="recommender_name" id="recommender_name" maxlength="50"
                required>
        </div>
        <div class="form-group">
            <label for="recommender_nin">Recommender NIN:</label>
            <input class="form-control" type="text" name="recommender_nin" id="recommender_nin" maxlength="14"
                pattern="[A-Z0-9]{14}" title="Recommender NIN must be exactly 14 alphanumeric characters" required>
        </div>
        <div class="form-group">
            <label for="recommender_tel">Recommender Tel:</label>
            <input class="form-control" type="text" name="recommender_tel" id="recommender_tel" maxlength="10"
                pattern="[0-9]{10}" title="Recommender phone must be exactly 10 digits" required>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Register Farmer</button>
            <a href="/salesagentdashboard/" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to
                Dashboard</a>
        </div>
    </form>
</section>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const dobInput = document.getElementById('date_of_birth');
        const form = document.querySelector('form');

        function validateAge() {
            const dob = new Date(dobInput.value);
            const today = new Date();
            const age = today.getFullYear() - dob.getFullYear() -
                ((today.getMonth() < dob.getMonth() ||
                    (today.getMonth() === dob.getMonth() && today.getDate() < dob.getDate())) ? 1 : 0);

            if (age < 20 || age > 30) {
                dobInput.setCustomValidity('Farmer must be between 20 and 30 years old.');
                return false;
            } else {
                dobInput.setCustomValidity('');
                return true;
            }
        }

        dobInput.addEventListener('change', validateAge);

        const phoneNumberInput = document.getElementById('phone_number');
        const recommenderTelInput = document.getElementById('recommender_tel');
        const recommenderNinInput = document.getElementById('recommender_nin');

        function validatePhoneNumber() {
            if (phoneNumberInput.value.length !== 10) {
                phoneNumberInput.setCustomValidity('Phone Number must be exactly 10 digits.');
                return false;
            } else {
                phoneNumberInput.setCustomValidity('');
                return true;
            }
        }

        function validateRecommenderTel() {
            if (recommenderTelInput.value.length !== 10) {
                recommenderTelInput.setCustomValidity('Recommender Tel must be exactly 10 digits.');
                return false;
            } else {
                recommenderTelInput.setCustomValidity('');
                return true;
            }
        }

        function validateRecommenderNin() {
            if (recommenderNinInput.value.length !== 14) {
                recommenderNinInput.setCustomValidity('Recommender NIN must be exactly 14 characters.');
                return false;
            } else {
                recommenderNinInput.setCustomValidity('');
                return true;
            }
        }

        phoneNumberInput.addEventListener('input', validatePhoneNumber);
        recommenderTelInput.addEventListener('input', validateRecommenderTel);
        recommenderNinInput.addEventListener('input', validateRecommenderNin);

        form.addEventListener('submit', function (e) {
            if (!validateAge() || !validatePhoneNumber() || !validateRecommenderTel() || !validateRecommenderNin()) {
                e.preventDefault();
                dobInput.reportValidity();
                phoneNumberInput.reportValidity();
                recommenderTelInput.reportValidity();
                recommenderNinInput.reportValidity();
            }
        });
    });
</script>
{% endblock %}
{% endblock %}